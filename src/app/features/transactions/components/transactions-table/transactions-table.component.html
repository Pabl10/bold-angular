<div class="transactions-table" [class.with-panel]="showDetailPanel">
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Cargando transacciones...</p>
  </div>
  
  <div *ngIf="error" class="error-container">
    <mat-icon>error</mat-icon>
    <p>{{ error }}</p>
  </div>
  
  <div *ngIf="!loading && !error" class="table-container">
    <table mat-table [dataSource]="transactions" class="transactions-table__table">
      <ng-container matColumnDef="transaction">
        <th mat-header-cell *matHeaderCellDef>Transacción</th>
        <td mat-cell *matCellDef="let transaction">
          <div class="transaction-cell">
            <mat-icon [class]="'status-' + transaction.status.toLowerCase()">
              {{ transaction.status | statusIcon }}
            </mat-icon>
            <span class="transaction-status">
              {{ transaction.status === 'SUCCESSFUL' ? 'Cobro exitoso' : 'Cobro no realizado' }}
            </span>
          </div>
        </td>
      </ng-container>
      
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Fecha y hora</th>
        <td mat-cell *matCellDef="let transaction">
          {{ transaction.createdAt | dateFormat }}
        </td>
      </ng-container>
      
      <ng-container matColumnDef="paymentMethod">
        <th mat-header-cell *matHeaderCellDef>Método de pago</th>
        <td mat-cell *matCellDef="let transaction">
          <div class="payment-method-cell">
            <mat-icon>{{ transaction.paymentMethod | paymentMethodIcon }}</mat-icon>
            <span>{{ transaction.paymentMethod }} **** {{ transaction.transactionReference.toString().slice(-4) }}</span>
          </div>
        </td>
      </ng-container>
      
      <ng-container matColumnDef="reference">
        <th mat-header-cell *matHeaderCellDef>ID transacción Bold</th>
        <td mat-cell *matCellDef="let transaction">
          {{ transaction.id }}
        </td>
      </ng-container>
      
      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef>Monto</th>
        <td mat-cell *matCellDef="let transaction">
          <div class="amount-cell">
            <div class="amount-main">{{ transaction.amount | currencyColombia }}</div>
            <div *ngIf="hasDeduction(transaction)" class="deduction">
              <p class="deduction-label">Deducción Bold</p>
              <p class="deduction-value">-{{ (transaction.deduction || 0) | currencyColombia }}</p>
            </div>
          </div>
        </td>
      </ng-container>
      
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
          (click)="onRowClick(row)" 
          class="transaction-row"
          [class.selected]="selectedTransaction?.id === row.id"></tr>
    </table>
  </div>
</div>

